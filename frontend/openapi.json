{
  "openapi": "3.0.3",
  "info": {
    "title": "Paris Sportif API",
    "version": "1.0.0",
    "description": "API de predictions de paris sportifs sur le football europeen"
  },
  "servers": [
    { "url": "http://localhost:8000", "description": "Local development" },
    { "url": "https://paris-sportif-api.onrender.com", "description": "Production" }
  ],
  "paths": {
    "/": {
      "get": {
        "tags": ["Root"],
        "summary": "Root endpoint",
        "operationId": "getRoot",
        "responses": {
          "200": {
            "description": "API information",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "name": { "type": "string" },
                    "version": { "type": "string" },
                    "docs": { "type": "string" }
                  },
                  "required": ["name", "version", "docs"]
                }
              }
            }
          }
        }
      }
    },
    "/health": {
      "get": {
        "tags": ["Health"],
        "summary": "Basic health check",
        "operationId": "healthCheck",
        "responses": {
          "200": {
            "description": "Service health",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": { "type": "string" },
                    "version": { "type": "string" }
                  },
                  "required": ["status", "version"]
                }
              }
            }
          }
        }
      }
    },
    "/health/ready": {
      "get": {
        "tags": ["Health"],
        "summary": "Readiness check including dependencies",
        "operationId": "readinessCheck",
        "responses": {
          "200": {
            "description": "Readiness status",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": { "type": "string" },
                    "database": { "type": "boolean" },
                    "redis": { "type": "boolean" },
                    "football_api": { "type": "boolean" },
                    "llm_api": { "type": "boolean" }
                  },
                  "required": ["status", "database", "redis", "football_api", "llm_api"]
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/matches": {
      "get": {
        "tags": ["Matches"],
        "summary": "Get list of matches with optional filters",
        "operationId": "getMatches",
        "parameters": [
          {
            "name": "competition",
            "in": "query",
            "required": false,
            "schema": { "type": "string" },
            "description": "Filter by competition code (e.g., PL, PD, BL1)"
          },
          {
            "name": "date_from",
            "in": "query",
            "required": false,
            "schema": { "type": "string", "format": "date" },
            "description": "Start date filter"
          },
          {
            "name": "date_to",
            "in": "query",
            "required": false,
            "schema": { "type": "string", "format": "date" },
            "description": "End date filter"
          },
          {
            "name": "status",
            "in": "query",
            "required": false,
            "schema": { "type": "string", "enum": ["scheduled", "live", "finished"] }
          },
          {
            "name": "page",
            "in": "query",
            "required": false,
            "schema": { "type": "integer", "default": 1, "minimum": 1 }
          },
          {
            "name": "per_page",
            "in": "query",
            "required": false,
            "schema": { "type": "integer", "default": 20, "minimum": 1, "maximum": 100 }
          }
        ],
        "responses": {
          "200": {
            "description": "Match list response",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/MatchListResponse" }
              }
            }
          }
        }
      }
    },
    "/api/v1/matches/upcoming": {
      "get": {
        "tags": ["Matches"],
        "summary": "Get upcoming matches for the next N days",
        "operationId": "getUpcomingMatches",
        "parameters": [
          {
            "name": "days",
            "in": "query",
            "required": false,
            "schema": { "type": "integer", "default": 2, "minimum": 1, "maximum": 7 },
            "description": "Number of days ahead"
          },
          {
            "name": "competition",
            "in": "query",
            "required": false,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "Upcoming matches",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/MatchListResponse" }
              }
            }
          }
        }
      }
    },
    "/api/v1/matches/{match_id}": {
      "get": {
        "tags": ["Matches"],
        "summary": "Get details for a specific match",
        "operationId": "getMatch",
        "parameters": [
          {
            "name": "match_id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer" },
            "description": "Match ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Match details",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/MatchResponse" }
              }
            }
          }
        }
      }
    },
    "/api/v1/matches/{match_id}/head-to-head": {
      "get": {
        "tags": ["Matches"],
        "summary": "Get head-to-head history for teams in a match",
        "operationId": "getHeadToHead",
        "parameters": [
          {
            "name": "match_id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer" }
          },
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": { "type": "integer", "default": 10, "minimum": 1, "maximum": 20 }
          }
        ],
        "responses": {
          "200": {
            "description": "Head-to-head history",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HeadToHeadResponse" }
              }
            }
          }
        }
      }
    },
    "/api/v1/matches/teams/{team_id}/form": {
      "get": {
        "tags": ["Matches"],
        "summary": "Get recent form for a team",
        "operationId": "getTeamForm",
        "parameters": [
          {
            "name": "team_id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer" }
          },
          {
            "name": "matches_count",
            "in": "query",
            "required": false,
            "schema": { "type": "integer", "default": 5, "minimum": 3, "maximum": 10 }
          }
        ],
        "responses": {
          "200": {
            "description": "Team form data",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/TeamFormResponse" }
              }
            }
          }
        }
      }
    },
    "/api/v1/matches/standings/{competition_code}": {
      "get": {
        "tags": ["Matches"],
        "summary": "Get current league standings for a competition",
        "operationId": "getStandings",
        "parameters": [
          {
            "name": "competition_code",
            "in": "path",
            "required": true,
            "schema": { "type": "string" },
            "description": "Competition code (PL, PD, BL1, SA, FL1)"
          }
        ],
        "responses": {
          "200": {
            "description": "League standings",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/StandingsResponse" }
              }
            }
          },
          "400": {
            "description": "Invalid competition code"
          }
        }
      }
    },
    "/api/v1/predictions/daily": {
      "get": {
        "tags": ["Predictions"],
        "summary": "Get the 5 best picks for the specified date",
        "operationId": "getDailyPicks",
        "parameters": [
          {
            "name": "date",
            "in": "query",
            "required": false,
            "schema": { "type": "string", "format": "date" },
            "description": "Date in YYYY-MM-DD format, defaults to today"
          }
        ],
        "responses": {
          "200": {
            "description": "Daily picks",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/DailyPicksResponse" }
              }
            }
          },
          "429": {
            "description": "Rate limit exceeded"
          },
          "502": {
            "description": "Error fetching matches"
          }
        }
      }
    },
    "/api/v1/predictions/{match_id}": {
      "get": {
        "tags": ["Predictions"],
        "summary": "Get detailed prediction for a specific match",
        "operationId": "getPrediction",
        "parameters": [
          {
            "name": "match_id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer" }
          },
          {
            "name": "include_model_details",
            "in": "query",
            "required": false,
            "schema": { "type": "boolean", "default": false },
            "description": "Include individual model contributions"
          }
        ],
        "responses": {
          "200": {
            "description": "Prediction details",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/PredictionResponse" }
              }
            }
          },
          "404": {
            "description": "Match not found"
          },
          "429": {
            "description": "Rate limit exceeded"
          }
        }
      }
    },
    "/api/v1/predictions/{match_id}/refresh": {
      "post": {
        "tags": ["Predictions"],
        "summary": "Force refresh a prediction (admin only)",
        "operationId": "refreshPrediction",
        "parameters": [
          {
            "name": "match_id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer" }
          }
        ],
        "responses": {
          "200": {
            "description": "Prediction refresh queued",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": { "type": "string" },
                    "match_id": { "type": "string" }
                  },
                  "required": ["status", "match_id"]
                }
              }
            }
          },
          "404": {
            "description": "Match not found"
          },
          "429": {
            "description": "Rate limit exceeded"
          }
        }
      }
    },
    "/api/v1/predictions/stats": {
      "get": {
        "tags": ["Predictions"],
        "summary": "Get historical prediction performance statistics",
        "operationId": "getPredictionStats",
        "parameters": [
          {
            "name": "days",
            "in": "query",
            "required": false,
            "schema": { "type": "integer", "default": 30, "minimum": 7, "maximum": 365 },
            "description": "Number of days to analyze"
          }
        ],
        "responses": {
          "200": {
            "description": "Prediction statistics",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/PredictionStatsResponse" }
              }
            }
          }
        }
      }
    },
    "/api/v1/rag/status": {
      "get": {
        "tags": ["RAG Enrichment"],
        "summary": "Get RAG system status",
        "operationId": "getRagStatus",
        "responses": {
          "200": {
            "description": "RAG status",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/RAGStatusResponse" }
              }
            }
          }
        }
      }
    },
    "/api/v1/rag/enrich": {
      "get": {
        "tags": ["RAG Enrichment"],
        "summary": "Enrich a match with contextual information using RAG",
        "operationId": "enrichMatch",
        "parameters": [
          {
            "name": "home_team",
            "in": "query",
            "required": true,
            "schema": { "type": "string" },
            "description": "Home team name"
          },
          {
            "name": "away_team",
            "in": "query",
            "required": true,
            "schema": { "type": "string" },
            "description": "Away team name"
          },
          {
            "name": "competition",
            "in": "query",
            "required": false,
            "schema": { "type": "string", "default": "PL" },
            "description": "Competition code (PL, SA, etc.)"
          },
          {
            "name": "match_date",
            "in": "query",
            "required": false,
            "schema": { "type": "string", "format": "date" },
            "description": "Match date in YYYY-MM-DD format"
          }
        ],
        "responses": {
          "200": {
            "description": "Match context",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/MatchContext" }
              }
            }
          },
          "500": {
            "description": "Failed to enrich match"
          }
        }
      }
    },
    "/api/v1/rag/analyze": {
      "post": {
        "tags": ["RAG Enrichment"],
        "summary": "Generate a detailed analysis of match context using LLM",
        "operationId": "analyzeMatchContext",
        "parameters": [
          {
            "name": "home_team",
            "in": "query",
            "required": true,
            "schema": { "type": "string" }
          },
          {
            "name": "away_team",
            "in": "query",
            "required": true,
            "schema": { "type": "string" }
          },
          {
            "name": "competition",
            "in": "query",
            "required": false,
            "schema": { "type": "string", "default": "PL" }
          },
          {
            "name": "additional_context",
            "in": "query",
            "required": false,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "Analysis result",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "home_team": { "type": "string" },
                    "away_team": { "type": "string" },
                    "competition": { "type": "string" },
                    "analysis": { "type": "string" },
                    "generated_at": { "type": "string", "format": "date-time" }
                  },
                  "required": ["home_team", "away_team", "competition", "analysis", "generated_at"]
                }
              }
            }
          },
          "500": {
            "description": "Failed to generate analysis"
          }
        }
      }
    },
    "/api/v1/debug/api-status": {
      "get": {
        "tags": ["Debug"],
        "summary": "Debug endpoint to verify football-data.org API configuration",
        "operationId": "debugApiStatus",
        "responses": {
          "200": {
            "description": "API status information",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "football_api": {
                      "type": "object",
                      "properties": {
                        "base_url": { "type": "string" },
                        "api_key_configured": { "type": "boolean" },
                        "api_key_length": { "type": "integer" },
                        "api_key_preview": { "type": "string" },
                        "client_headers": {
                          "type": "object",
                          "properties": {
                            "configured": { "type": "boolean" },
                            "x_auth_token_present": { "type": "boolean" }
                          }
                        },
                        "connectivity_test": {
                          "type": "object",
                          "properties": {
                            "status": { "type": "string" },
                            "http_status_code": { "type": "integer", "nullable": true },
                            "error": { "type": "string", "nullable": true }
                          }
                        }
                      }
                    },
                    "settings": {
                      "type": "object",
                      "properties": {
                        "app_env": { "type": "string" },
                        "app_version": { "type": "string" },
                        "debug_mode": { "type": "boolean" },
                        "log_level": { "type": "string" }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/ml/status": {
      "get": {
        "tags": ["Machine Learning"],
        "summary": "Get current ML system status",
        "operationId": "getMlStatus",
        "responses": {
          "200": {
            "description": "ML system status",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/MLStatusResponse" }
              }
            }
          }
        }
      }
    },
    "/api/v1/ml/collect": {
      "post": {
        "tags": ["Machine Learning"],
        "summary": "Start data collection in background",
        "operationId": "collectData",
        "responses": {
          "200": {
            "description": "Data collection started",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/PipelineResponse" }
              }
            }
          },
          "409": {
            "description": "A pipeline task is already running"
          }
        }
      }
    },
    "/api/v1/ml/train": {
      "post": {
        "tags": ["Machine Learning"],
        "summary": "Start model training in background",
        "operationId": "trainModels",
        "responses": {
          "200": {
            "description": "Model training started",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/PipelineResponse" }
              }
            }
          },
          "409": {
            "description": "A pipeline task is already running"
          }
        }
      }
    },
    "/api/v1/ml/run-full": {
      "post": {
        "tags": ["Machine Learning"],
        "summary": "Run full ML pipeline in background",
        "operationId": "runFullPipeline",
        "responses": {
          "200": {
            "description": "Full ML pipeline started",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/PipelineResponse" }
              }
            }
          },
          "409": {
            "description": "A pipeline task is already running"
          }
        }
      }
    },
    "/api/v1/ml/pipeline-status": {
      "get": {
        "tags": ["Machine Learning"],
        "summary": "Get current pipeline execution status",
        "operationId": "getPipelineStatus",
        "responses": {
          "200": {
            "description": "Pipeline status",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/PipelineResponse" }
              }
            }
          }
        }
      }
    },
    "/api/v1/sync/weekly": {
      "post": {
        "tags": ["Data Sync"],
        "summary": "Trigger weekly data synchronization",
        "operationId": "syncWeeklyData",
        "parameters": [
          {
            "name": "days",
            "in": "query",
            "required": false,
            "schema": { "type": "integer", "default": 7, "minimum": 1, "maximum": 14 },
            "description": "Number of days to sync"
          },
          {
            "name": "include_standings",
            "in": "query",
            "required": false,
            "schema": { "type": "boolean", "default": true },
            "description": "Also sync standings"
          }
        ],
        "responses": {
          "200": {
            "description": "Sync completed",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/SyncResponse" }
              }
            }
          },
          "500": {
            "description": "Sync failed"
          }
        }
      }
    },
    "/api/v1/sync/matches": {
      "post": {
        "tags": ["Data Sync"],
        "summary": "Sync only matches (no standings)",
        "operationId": "syncMatchesOnly",
        "parameters": [
          {
            "name": "days",
            "in": "query",
            "required": false,
            "schema": { "type": "integer", "default": 7, "minimum": 1, "maximum": 14 }
          }
        ],
        "responses": {
          "200": {
            "description": "Matches synced",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/SyncResponse" }
              }
            }
          },
          "500": {
            "description": "Sync failed"
          }
        }
      }
    },
    "/api/v1/sync/standings": {
      "post": {
        "tags": ["Data Sync"],
        "summary": "Sync only standings (no matches)",
        "operationId": "syncStandingsOnly",
        "responses": {
          "200": {
            "description": "Standings synced",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/SyncResponse" }
              }
            }
          },
          "500": {
            "description": "Sync failed"
          }
        }
      }
    },
    "/api/v1/sync/status": {
      "get": {
        "tags": ["Data Sync"],
        "summary": "Get database sync status and statistics",
        "operationId": "getSyncStatus",
        "responses": {
          "200": {
            "description": "Sync status",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/DbStatsResponse" }
              }
            }
          }
        }
      }
    },
    "/api/v1/sync/last": {
      "get": {
        "tags": ["Data Sync"],
        "summary": "Get info about the last successful sync",
        "operationId": "getLastSyncInfo",
        "parameters": [
          {
            "name": "sync_type",
            "in": "query",
            "required": false,
            "schema": { "type": "string", "default": "weekly" }
          }
        ],
        "responses": {
          "200": {
            "description": "Last sync info",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "TeamInfo": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "name": { "type": "string" },
          "short_name": { "type": "string" },
          "logo_url": { "type": "string", "nullable": true },
          "elo_rating": { "type": "number", "default": 1500.0 }
        },
        "required": ["id", "name", "short_name"]
      },
      "MatchResponse": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "external_id": { "type": "string" },
          "home_team": { "$ref": "#/components/schemas/TeamInfo" },
          "away_team": { "$ref": "#/components/schemas/TeamInfo" },
          "competition": { "type": "string" },
          "competition_code": { "type": "string" },
          "match_date": { "type": "string", "format": "date-time" },
          "status": { "type": "string", "enum": ["scheduled", "live", "finished", "postponed"] },
          "home_score": { "type": "integer", "nullable": true },
          "away_score": { "type": "integer", "nullable": true },
          "matchday": { "type": "integer", "nullable": true }
        },
        "required": ["id", "external_id", "home_team", "away_team", "competition", "competition_code", "match_date", "status"]
      },
      "MatchListResponse": {
        "type": "object",
        "properties": {
          "matches": { "type": "array", "items": { "$ref": "#/components/schemas/MatchResponse" } },
          "total": { "type": "integer" },
          "page": { "type": "integer" },
          "per_page": { "type": "integer" }
        },
        "required": ["matches", "total", "page", "per_page"]
      },
      "TeamFormMatch": {
        "type": "object",
        "properties": {
          "opponent": { "type": "string" },
          "result": { "type": "string", "enum": ["W", "D", "L"] },
          "score": { "type": "string" },
          "home_away": { "type": "string", "enum": ["H", "A"] },
          "date": { "type": "string", "format": "date-time" }
        },
        "required": ["opponent", "result", "score", "home_away", "date"]
      },
      "TeamFormResponse": {
        "type": "object",
        "properties": {
          "team_id": { "type": "integer" },
          "team_name": { "type": "string" },
          "last_matches": { "type": "array", "items": { "$ref": "#/components/schemas/TeamFormMatch" } },
          "form_string": { "type": "string" },
          "points_last_5": { "type": "integer" },
          "goals_scored_avg": { "type": "number" },
          "goals_conceded_avg": { "type": "number" },
          "clean_sheets": { "type": "integer" },
          "xg_for_avg": { "type": "number", "nullable": true },
          "xg_against_avg": { "type": "number", "nullable": true }
        },
        "required": ["team_id", "team_name", "last_matches", "form_string", "points_last_5", "goals_scored_avg", "goals_conceded_avg", "clean_sheets"]
      },
      "StandingTeamResponse": {
        "type": "object",
        "properties": {
          "position": { "type": "integer" },
          "team_id": { "type": "integer" },
          "team_name": { "type": "string" },
          "team_logo_url": { "type": "string", "nullable": true },
          "played": { "type": "integer" },
          "won": { "type": "integer" },
          "drawn": { "type": "integer" },
          "lost": { "type": "integer" },
          "goals_for": { "type": "integer" },
          "goals_against": { "type": "integer" },
          "goal_difference": { "type": "integer" },
          "points": { "type": "integer" }
        },
        "required": ["position", "team_id", "team_name", "played", "won", "drawn", "lost", "goals_for", "goals_against", "goal_difference", "points"]
      },
      "StandingsResponse": {
        "type": "object",
        "properties": {
          "competition_code": { "type": "string" },
          "competition_name": { "type": "string" },
          "standings": { "type": "array", "items": { "$ref": "#/components/schemas/StandingTeamResponse" } },
          "last_updated": { "type": "string", "format": "date-time", "nullable": true }
        },
        "required": ["competition_code", "competition_name", "standings"]
      },
      "HeadToHeadMatch": {
        "type": "object",
        "properties": {
          "date": { "type": "string", "format": "date-time" },
          "home_team": { "type": "string" },
          "away_team": { "type": "string" },
          "home_score": { "type": "integer" },
          "away_score": { "type": "integer" },
          "competition": { "type": "string" }
        },
        "required": ["date", "home_team", "away_team", "home_score", "away_score", "competition"]
      },
      "HeadToHeadResponse": {
        "type": "object",
        "properties": {
          "matches": { "type": "array", "items": { "$ref": "#/components/schemas/HeadToHeadMatch" } },
          "home_wins": { "type": "integer" },
          "draws": { "type": "integer" },
          "away_wins": { "type": "integer" },
          "avg_goals": { "type": "number" },
          "total_matches": { "type": "integer" }
        },
        "required": ["matches", "home_wins", "draws", "away_wins", "avg_goals", "total_matches"]
      },
      "PredictionProbabilities": {
        "type": "object",
        "properties": {
          "home_win": { "type": "number", "minimum": 0, "maximum": 1 },
          "draw": { "type": "number", "minimum": 0, "maximum": 1 },
          "away_win": { "type": "number", "minimum": 0, "maximum": 1 }
        },
        "required": ["home_win", "draw", "away_win"]
      },
      "ModelContributions": {
        "type": "object",
        "properties": {
          "poisson": { "$ref": "#/components/schemas/PredictionProbabilities" },
          "xgboost": { "$ref": "#/components/schemas/PredictionProbabilities" },
          "xg_model": { "$ref": "#/components/schemas/PredictionProbabilities" },
          "elo": { "$ref": "#/components/schemas/PredictionProbabilities" }
        },
        "required": ["poisson", "xgboost", "xg_model", "elo"]
      },
      "LLMAdjustments": {
        "type": "object",
        "properties": {
          "injury_impact_home": { "type": "number", "minimum": -0.3, "maximum": 0.0 },
          "injury_impact_away": { "type": "number", "minimum": -0.3, "maximum": 0.0 },
          "sentiment_home": { "type": "number", "minimum": -0.1, "maximum": 0.1 },
          "sentiment_away": { "type": "number", "minimum": -0.1, "maximum": 0.1 },
          "tactical_edge": { "type": "number", "minimum": -0.05, "maximum": 0.05 },
          "total_adjustment": { "type": "number", "minimum": -0.5, "maximum": 0.5 },
          "reasoning": { "type": "string" }
        },
        "required": ["reasoning"]
      },
      "PredictionResponse": {
        "type": "object",
        "properties": {
          "match_id": { "type": "integer" },
          "home_team": { "type": "string" },
          "away_team": { "type": "string" },
          "competition": { "type": "string" },
          "match_date": { "type": "string", "format": "date-time" },
          "probabilities": { "$ref": "#/components/schemas/PredictionProbabilities" },
          "recommended_bet": { "type": "string", "enum": ["home_win", "draw", "away_win"] },
          "confidence": { "type": "number", "minimum": 0, "maximum": 1 },
          "value_score": { "type": "number" },
          "explanation": { "type": "string" },
          "key_factors": { "type": "array", "items": { "type": "string" } },
          "risk_factors": { "type": "array", "items": { "type": "string" } },
          "model_contributions": { "$ref": "#/components/schemas/ModelContributions", "nullable": true },
          "llm_adjustments": { "$ref": "#/components/schemas/LLMAdjustments", "nullable": true },
          "created_at": { "type": "string", "format": "date-time" },
          "is_daily_pick": { "type": "boolean", "default": false }
        },
        "required": ["match_id", "home_team", "away_team", "competition", "match_date", "probabilities", "recommended_bet", "confidence", "value_score", "explanation", "key_factors", "risk_factors", "created_at"]
      },
      "DailyPickResponse": {
        "type": "object",
        "properties": {
          "rank": { "type": "integer", "minimum": 1, "maximum": 5 },
          "prediction": { "$ref": "#/components/schemas/PredictionResponse" },
          "pick_score": { "type": "number" }
        },
        "required": ["rank", "prediction", "pick_score"]
      },
      "DailyPicksResponse": {
        "type": "object",
        "properties": {
          "date": { "type": "string", "format": "date" },
          "picks": { "type": "array", "items": { "$ref": "#/components/schemas/DailyPickResponse" } },
          "total_matches_analyzed": { "type": "integer" }
        },
        "required": ["date", "picks", "total_matches_analyzed"]
      },
      "PredictionStatsResponse": {
        "type": "object",
        "properties": {
          "total_predictions": { "type": "integer" },
          "correct_predictions": { "type": "integer" },
          "accuracy": { "type": "number" },
          "roi_simulated": { "type": "number" },
          "by_competition": { "type": "object" },
          "by_bet_type": { "type": "object" },
          "last_updated": { "type": "string", "format": "date-time" }
        },
        "required": ["total_predictions", "correct_predictions", "accuracy", "roi_simulated", "by_competition", "by_bet_type", "last_updated"]
      },
      "RAGStatusResponse": {
        "type": "object",
        "properties": {
          "enabled": { "type": "boolean" },
          "groq_configured": { "type": "boolean" },
          "last_enrichment": { "type": "string", "format": "date-time", "nullable": true },
          "total_enrichments": { "type": "integer" }
        },
        "required": ["enabled", "groq_configured", "total_enrichments"]
      },
      "TeamContext": {
        "type": "object",
        "properties": {
          "team_name": { "type": "string" },
          "recent_news": { "type": "array", "items": { "type": "string" } },
          "injuries": { "type": "array", "items": { "type": "string" } },
          "sentiment_score": { "type": "number", "minimum": -1.0, "maximum": 1.0 },
          "sentiment_label": { "type": "string" }
        },
        "required": ["team_name"]
      },
      "MatchContext": {
        "type": "object",
        "properties": {
          "home_team": { "type": "string" },
          "away_team": { "type": "string" },
          "competition": { "type": "string" },
          "match_date": { "type": "string", "format": "date-time" },
          "home_context": { "$ref": "#/components/schemas/TeamContext" },
          "away_context": { "$ref": "#/components/schemas/TeamContext" },
          "is_derby": { "type": "boolean", "default": false },
          "match_importance": { "type": "string", "default": "normal" },
          "combined_analysis": { "type": "string", "nullable": true },
          "enriched_at": { "type": "string", "format": "date-time" },
          "sources_used": { "type": "array", "items": { "type": "string" } }
        },
        "required": ["home_team", "away_team", "competition", "match_date", "home_context", "away_context", "enriched_at"]
      },
      "MLStatusResponse": {
        "type": "object",
        "properties": {
          "models_trained": { "type": "boolean" },
          "xgboost_available": { "type": "boolean" },
          "random_forest_available": { "type": "boolean" },
          "data_age_days": { "type": "integer", "nullable": true },
          "last_training": { "type": "string", "format": "date-time", "nullable": true },
          "feature_state_loaded": { "type": "boolean" }
        },
        "required": ["models_trained", "xgboost_available", "random_forest_available", "feature_state_loaded"]
      },
      "PipelineResponse": {
        "type": "object",
        "properties": {
          "message": { "type": "string" },
          "status": { "type": "string" },
          "task_id": { "type": "string", "nullable": true }
        },
        "required": ["message", "status"]
      },
      "SyncResponse": {
        "type": "object",
        "properties": {
          "status": { "type": "string" },
          "message": { "type": "string" },
          "matches_synced": { "type": "integer", "default": 0 },
          "standings_synced": { "type": "integer", "default": 0 },
          "errors": { "type": "array", "items": { "type": "string" } }
        },
        "required": ["status", "message"]
      },
      "DbStatsResponse": {
        "type": "object",
        "properties": {
          "total_matches": { "type": "integer" },
          "competitions_with_standings": { "type": "integer" },
          "last_match_sync": { "type": "string", "nullable": true },
          "last_standings_sync": { "type": "string", "nullable": true }
        },
        "required": ["total_matches", "competitions_with_standings"]
      }
    }
  }
}
